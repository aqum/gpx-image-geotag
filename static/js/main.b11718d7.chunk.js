(window.webpackJsonpgeotag=window.webpackJsonpgeotag||[]).push([[0],{132:function(e,t,a){},133:function(e,t,a){},134:function(e,t,a){},141:function(e,t,a){},142:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(33),i=a.n(o),s=(a(82),a(70)),l=a(76),c=a(6),u=a(7),m=a(10),f=a(8),p=a(12),h=a(11),g=(a(83),a(13)),d=a.n(g),b=a(18),v=a(71),O=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(m.a)(this,Object(f.a)(t).call(this,e))).handleFileChange=a.handleFileChange.bind(Object(p.a)(a)),a}return Object(h.a)(t,e),Object(u.a)(t,[{key:"handleFileChange",value:function(){var e=Object(b.a)(d.a.mark((function e(a){var n,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=a.target.files)&&n[0]){e.next=4;break}return this.props.onChange([]),e.abrupt("return");case 4:return e.next=6,t.convertFileToGpxPoints(n[0]);case 6:r=e.sent,this.props.onChange(r);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement("form",null,r.a.createElement("input",{type:"file",onChange:this.handleFileChange,accept:".gpx"}))}}],[{key:"convertFileToGpxPoints",value:function(e){var t=new FileReader;return new Promise((function(a,n){t.onload=function(e){e.target&&e.target.result||n("convertFileToGpxPoints: empty file");var r=v.parse(t.result,{attributeNamePrefix:"",ignoreAttributes:!1}).gpx.trk.trkseg.trkpt.map((function(e){return{lat:parseFloat(e.lat),lon:parseFloat(e.lon),ele:e.ele,time:new Date(e.time)}}));a(r)},t.onerror=function(){return n("convertFileToGpxPoints: unknown error")},t.onabort=function(){return n("convertFileToGpxPoints: abort")},t.readAsText(e)}))}}]),t}(n.Component),E=a(14);function y(){return(y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function w(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var j=r.a.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"}),k=function(e){var t=e.svgRef,a=e.title,n=w(e,["svgRef","title"]);return r.a.createElement("svg",y({width:24,height:24,viewBox:"0 0 24 24",ref:t},n),r.a.createElement("title",null,a),j)},x=r.a.forwardRef((function(e,t){return r.a.createElement(k,y({svgRef:t},e))})),C=(a.p,a(91),function(e){function t(){return Object(c.a)(this,t),Object(m.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"message-box"},r.a.createElement("div",{className:"message-box__icon"},r.a.createElement(x,null)),r.a.createElement("div",{className:"message-box__text"},this.props.text))}}]),t}(n.Component)),P=(a(92),function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(m.a)(this,Object(f.a)(t).call(this,e))).handleImageChange=a.handleImageChange.bind(Object(p.a)(a)),a}return Object(h.a)(t,e),Object(u.a)(t,[{key:"handleImageChange",value:function(){var e=Object(b.a)(d.a.mark((function e(a){var n,r,o,i,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=a.target.files)&&n[0]){e.next=4;break}return this.props.onImagesChange([]),e.abrupt("return");case 4:return r=Array.from(n).map((function(e){return t.convertFileToDataUrl(e)})),e.next=7,Promise.all(r);case 7:return o=e.sent,i=o.map(function(){var e=Object(b.a)(d.a.mark((function e(a){var n,r,o,i,s,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.resizeImage(a.dataUrl,200,200);case 2:return e.t0=e.sent,e.t1=a.name,e.t2=a.lastModified,e.t3=a.dataUrl,n={thumbnailUrl:e.t0,name:e.t1,lastModified:e.t2,originalDataUrl:e.t3},r=E.load(a.dataUrl),o=r.GPS[E.GPSIFD.GPSLatitude],i=r.GPS[E.GPSIFD.GPSLongitude],o&&i&&(s=E.GPSHelper.dmsRationalToDeg(o),l=E.GPSHelper.dmsRationalToDeg(i),n.gps={lat:s,lon:l}),e.abrupt("return",n);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=11,Promise.all(i);case 11:s=e.sent,this.props.onImagesChange(s);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement("form",{className:"images-form"},r.a.createElement("input",{className:"images-form__input",type:"file",multiple:!0,onChange:this.handleImageChange,accept:".jpg,.jpeg"}),r.a.createElement(C,{text:"There are no limits in number of images but if yours are large and you have many of them it may take more time to load."}),r.a.createElement(C,{text:'It is better not to mix photos from different cameras. Their internal clock might not be synchronized. See "How it works" below for additional information.'}),r.a.createElement(C,{text:"You can choose photos files before GPX file to see photos with existing GPS data on map."}))}}],[{key:"resizeImage",value:function(){var e=Object(b.a)(d.a.mark((function e(t,a,n){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Image,e.abrupt("return",new Promise((function(e,o){r.onload=function(){var t=r.width>r.height?a/r.width:n/r.height,i=r.width*t,s=r.height*t,l=document.createElement("canvas");l.width=i,l.height=s;var c=l.getContext("2d");c?(c.drawImage(r,0,0,i,s),e(l.toDataURL())):o("resizeImage: context is null")},r.onerror=function(){return o("resizeImage: unknown error")},r.onabort=function(){return o("resizeImage: abort")},r.src=t})));case 2:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"convertFileToDataUrl",value:function(e){var t=new FileReader;return new Promise((function(a,n){t.onload=function(t){var r=t.target&&t.target.result;r||n("convertFileToDataUrl: empty file"),a({dataUrl:r||"",name:e.name,lastModified:new Date(e.lastModified)})},t.onerror=function(){return n("convertFileToDataUrl: unknown error")},t.onabort=function(){return n("convertFileToDataUrl: abort")},t.readAsDataURL(e)}))}}]),t}(n.Component)),_=a(72),G=a.n(_),I=a(73),D=(a(132),function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(m.a)(this,Object(f.a)(t).call(this,e))).handleDownload=a.handleDownload.bind(Object(p.a)(a)),a}return Object(h.a)(t,e),Object(u.a)(t,[{key:"handleDownload",value:function(){var e=Object(b.a)(d.a.mark((function e(){var a,n,r,o,i,s,l,c,u;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=new G.a,n=!0,r=!1,o=void 0,e.prev=4,i=this.props.images[Symbol.iterator]();case 6:if(n=(s=i.next()).done){e.next=15;break}return l=s.value,e.next=10,t.createBlobWithGps(l);case 10:c=e.sent,a.file(c.fileName,c.blob);case 12:n=!0,e.next=6;break;case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(4),r=!0,o=e.t0;case 21:e.prev=21,e.prev=22,n||null==i.return||i.return();case 24:if(e.prev=24,!r){e.next=27;break}throw o;case 27:return e.finish(24);case 28:return e.finish(21);case 29:return e.next=31,a.generateAsync({type:"blob"});case 31:u=e.sent,Object(I.saveAs)(u,"geotagged-photos.zip");case 33:case"end":return e.stop()}}),e,this,[[4,17,21,29],[22,,24,28]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return r.a.createElement("div",{className:"geotag-download"},r.a.createElement(C,{text:"Existing GPS data will be replaced. Files outside GPS range won't be modified."}),r.a.createElement("button",{onClick:this.handleDownload,className:"geotag-download__button"},"Download .zip file"))}}],[{key:"createBlobWithGps",value:function(){var e=Object(b.a)(d.a.mark((function e(t){var a,n,r,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=E.load(t.originalDataUrl),t.gps&&(a.GPS[E.GPSIFD.GPSLatitude]=E.GPSHelper.degToDmsRational(t.gps.lat),a.GPS[E.GPSIFD.GPSLongitude]=E.GPSHelper.degToDmsRational(t.gps.lon)),n=E.dump(a),r=E.insert(n,t.originalDataUrl),e.next=6,fetch(r).then((function(e){return e.blob()}));case 6:return o=e.sent,e.abrupt("return",{blob:o,fileName:t.name});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),t}(n.Component)),N=(a(133),function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(m.a)(this,Object(f.a)(t).call(this,e))).state={offset:0},a.handleOffsetChange=a.handleOffsetChange.bind(Object(p.a)(a)),a.handleOffsetDiff=a.handleOffsetDiff.bind(Object(p.a)(a)),a}return Object(h.a)(t,e),Object(u.a)(t,[{key:"handleOffsetChange",value:function(e){var t=this,a=parseInt(e.target.value);this.setState({offset:a},(function(){t.props.onChange(a)}))}},{key:"handleOffsetDiff",value:function(e){var t=this;return function(){var a=t.state.offset+e;t.setState({offset:a},(function(){t.props.onChange(a)}))}}},{key:"render",value:function(){return r.a.createElement("div",{className:"offset-control"},r.a.createElement("div",{className:"offset-control__label"},"offset in seconds"),r.a.createElement("div",{className:"offset-control__inputs"},r.a.createElement("button",{className:"offset-control__button",onClick:this.handleOffsetDiff(-60)},"-60"),r.a.createElement("button",{className:"offset-control__button",onClick:this.handleOffsetDiff(-1)},"-1"),r.a.createElement("input",{className:"offset-control__input",type:"number",value:this.state.offset,onChange:this.handleOffsetChange}),r.a.createElement("button",{className:"offset-control__button",onClick:this.handleOffsetDiff(1)},"+1"),r.a.createElement("button",{className:"offset-control__button",onClick:this.handleOffsetDiff(60)},"+60")))}}]),t}(n.Component)),S=a(145),F=a(148),T=a(146),U=a(144),z=a(147),R=(a(134),a(135),a(5)),L=a.n(R);delete L.a.Icon.Default.prototype._getIconUrl,L.a.Icon.Default.mergeOptions({iconRetinaUrl:a(136),iconUrl:a(137),shadowUrl:a(138)});var M=function(e){function t(){return Object(c.a)(this,t),Object(m.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.points.map((function(e){return[e.lat,e.lon]})),t=[[0,0],[75,180]];return e.length>1&&(t=[e[0],e[e.length-1]]),r.a.createElement("div",{className:"images-map"},r.a.createElement(S.a,{bounds:t},r.a.createElement(F.a,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),r.a.createElement(T.a,{positions:e}),this.props.images.filter((function(e){return e.gps})).map((function(e){return r.a.createElement(U.a,{position:e.gps&&[e.gps.lat,e.gps.lon],key:e.name},r.a.createElement(z.a,null,r.a.createElement("img",{src:e.thumbnailUrl,width:"50",alt:e.name}),r.a.createElement("br",null),e.name))}))))}}]),t}(n.Component),A=(a(141),function(e){function t(){return Object(c.a)(this,t),Object(m.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.images.filter((function(e){return!e.gps}));return r.a.createElement("section",{className:"g-step"},r.a.createElement("h2",{className:"g-step__title"},"Corelate time"),r.a.createElement(N,{onChange:this.props.onOffsetChange}),r.a.createElement(M,{images:this.props.images,points:this.props.points}),e.length>0&&r.a.createElement("div",{className:"outside-range"},r.a.createElement("h3",{className:"outside-range__title"},"Images with dates outside GPX range"),r.a.createElement("div",{className:"outside-range__list"},e.map((function(e){return r.a.createElement("img",{className:"outside-range__image",src:e.thumbnailUrl,width:"50",alt:e.name,title:e.name,key:e.name})})))),r.a.createElement(C,{text:"Your GPX recorder (f.e. phone) and your camera might not share the same time. Check your photos and update offset if necessary."}))}}]),t}(n.Component));function X(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function H(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?X(a,!0).forEach((function(t){Object(s.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):X(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var B=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(m.a)(this,Object(f.a)(t).call(this,e))).handleImagesChange=a.handleImagesChange.bind(Object(p.a)(a)),a.handleGpxChange=a.handleGpxChange.bind(Object(p.a)(a)),a.handleOffsetChange=a.handleOffsetChange.bind(Object(p.a)(a)),a.state={images:[],points:[],offsetSecs:0},a}return Object(h.a)(t,e),Object(u.a)(t,[{key:"handleImagesChange",value:function(e){var t=this;this.setState({images:e},(function(){t.updateImagesLocation()}))}},{key:"handleGpxChange",value:function(e){var t=this;this.setState({points:e},(function(){t.updateImagesLocation()}))}},{key:"updateImagesLocation",value:function(){var e=this,a=this.state.images.map((function(a){return t.attachGpsCoordinates(a,e.state.points,e.state.offsetSecs)}));this.setState({images:a})}},{key:"handleOffsetChange",value:function(e){var t=this;this.setState({offsetSecs:e},(function(){t.updateImagesLocation()}))}},{key:"render",value:function(){return r.a.createElement("div",{className:"geotag"},r.a.createElement("section",{className:"g-header"},r.a.createElement("h1",{className:"g-header__title"},"Geotag your photos"),r.a.createElement("h3",{className:"g-header__subtitle"},"No upload needed")),r.a.createElement("div",{className:"geotag__steps"},r.a.createElement("section",{className:"g-step"},r.a.createElement("h2",{className:"g-step__title"},"Select GPX file"),r.a.createElement(O,{onChange:this.handleGpxChange})),r.a.createElement("section",{className:"g-step"},r.a.createElement("h2",{className:"g-step__title"},"Pick .jpg photos"),r.a.createElement(P,{onImagesChange:this.handleImagesChange})),r.a.createElement(A,{images:this.state.images,points:this.state.points,onOffsetChange:this.handleOffsetChange}),r.a.createElement("section",{className:"g-step"},r.a.createElement("h2",{className:"g-step__title"},"Finish"),r.a.createElement(D,{images:this.state.images})),r.a.createElement("section",{className:"g-step"},r.a.createElement("h2",{className:"g-step__title"},"Read more"),r.a.createElement("h4",null,"About project"),r.a.createElement("p",null,"This is side-project that I built because I couldn't find good enough solution to geotag my photos. It doesn't require any upload. Images are processed inside your browser."),r.a.createElement("p",null,"If you find it useful or the exact opposite - it doesn't work for you - let me know (see author section)."),r.a.createElement("p",null,"Code is open sourced so feel free to inspect it or contribute on"," ",r.a.createElement("a",{href:"https://github.com/aqum/gpx-image-geotag"},"Github")),r.a.createElement("h4",null,"What is GPX file?"),r.a.createElement("p",null,"GPX file is basically collection of coordinates and timestamps. Is is structurized using XML tags so computer can parse it more easily. You can open it in text editor and see for yourself."),r.a.createElement("p",null,"Here is sample line from GPX file:"),r.a.createElement("code",null,r.a.createElement("pre",null,'<trkpt lat="50.8761400" lon="15.1888720">\n  <ele>377.5</ele>\n  <time>2019-08-17T09:49:06Z</time>\n</trkpt>')),r.a.createElement("h4",null,"How it works?"),r.a.createElement("p",null,"Your photo has creation date. Based on this we can look for closest timestamp in GPX file. Then we take coordinates and write them to jpeg metadata known also as"," ",r.a.createElement("a",{href:"https://pl.wikipedia.org/wiki/Exchangeable_Image_File_Format"},"Exif"),"."),r.a.createElement("p",null,"Of course you can do it yourself but with this app it is much faster. Isn't it? ;)"),r.a.createElement("h4",null,"Author"),r.a.createElement("p",null,"My name is Adam Florczak. I'm based in Warsaw (Poland) and I do programming for a living."),r.a.createElement("p",null,"Here is blog (in Polish) about my trips:"," ",r.a.createElement("a",{href:"https://rowerotopia.pl"},"rowerotopia.pl")),r.a.createElement("p",null,"My email: adam.florczak [at] me.com"),r.a.createElement("p",null,r.a.createElement("a",{href:"https://www.linkedin.com/in/adam-florczak-4379b692/"},"Linkedin")))))}}],[{key:"attachGpsCoordinates",value:function(e,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=new Date(e.lastModified.getTime()+1e3*n),o=Object(l.a)(a).sort((function(e,t){return s(e)-s(t)})),i=o[0]&&s(o[0])<=t.maxGpsTimeframeSecs?o[0]:void 0;return i?H({},e,{gps:{lat:i.lat,lon:i.lon}}):e;function s(e){return Math.abs(e.time.getTime()-r.getTime())/1e3}}}]),t}(n.Component);B.maxGpsTimeframeSecs=900,i.a.render(r.a.createElement(B,null),document.getElementById("root"))},77:function(e,t,a){e.exports=a(142)},82:function(e,t,a){},83:function(e,t,a){},91:function(e,t,a){},92:function(e,t,a){},97:function(e,t){},99:function(e,t){}},[[77,1,2]]]);
//# sourceMappingURL=main.b11718d7.chunk.js.map